<!DOCTYPE html>
    <head>
        <title>
            Setting_up_lsp_nvim-lspconfig_and_perl_in_neovim
        </title>
        <style type="text/css">
        .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .cm {
  color: #999988;
  font-style: italic;
}
.highlight .cp {
  color: #999999;
  font-weight: bold;
}
.highlight .c1 {
  color: #999988;
  font-style: italic;
}
.highlight .cs {
  color: #999999;
  font-weight: bold;
  font-style: italic;
}
.highlight .c, .highlight .ch, .highlight .cd, .highlight .cpf {
  color: #999988;
  font-style: italic;
}
.highlight .err {
  color: #a61717;
  background-color: #e3d2d2;
}
.highlight .gd {
  color: #000000;
  background-color: #ffdddd;
}
.highlight .ge {
  color: #000000;
  font-style: italic;
}
.highlight .gr {
  color: #aa0000;
}
.highlight .gh {
  color: #999999;
}
.highlight .gi {
  color: #000000;
  background-color: #ddffdd;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
  font-weight: bold;
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .gt {
  color: #aa0000;
}
.highlight .kc {
  color: #000000;
  font-weight: bold;
}
.highlight .kd {
  color: #000000;
  font-weight: bold;
}
.highlight .kn {
  color: #000000;
  font-weight: bold;
}
.highlight .kp {
  color: #000000;
  font-weight: bold;
}
.highlight .kr {
  color: #000000;
  font-weight: bold;
}
.highlight .kt {
  color: #445588;
  font-weight: bold;
}
.highlight .k, .highlight .kv {
  color: #000000;
  font-weight: bold;
}
.highlight .mf {
  color: #009999;
}
.highlight .mh {
  color: #009999;
}
.highlight .il {
  color: #009999;
}
.highlight .mi {
  color: #009999;
}
.highlight .mo {
  color: #009999;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #009999;
}
.highlight .sa {
  color: #000000;
  font-weight: bold;
}
.highlight .sb {
  color: #d14;
}
.highlight .sc {
  color: #d14;
}
.highlight .sd {
  color: #d14;
}
.highlight .s2 {
  color: #d14;
}
.highlight .se {
  color: #d14;
}
.highlight .sh {
  color: #d14;
}
.highlight .si {
  color: #d14;
}
.highlight .sx {
  color: #d14;
}
.highlight .sr {
  color: #009926;
}
.highlight .s1 {
  color: #d14;
}
.highlight .ss {
  color: #990073;
}
.highlight .s, .highlight .dl {
  color: #d14;
}
.highlight .na {
  color: #008080;
}
.highlight .bp {
  color: #999999;
}
.highlight .nb {
  color: #0086B3;
}
.highlight .nc {
  color: #445588;
  font-weight: bold;
}
.highlight .no {
  color: #008080;
}
.highlight .nd {
  color: #3c5d5d;
  font-weight: bold;
}
.highlight .ni {
  color: #800080;
}
.highlight .ne {
  color: #990000;
  font-weight: bold;
}
.highlight .nf, .highlight .fm {
  color: #990000;
  font-weight: bold;
}
.highlight .nl {
  color: #990000;
  font-weight: bold;
}
.highlight .nn {
  color: #555555;
}
.highlight .nt {
  color: #000080;
}
.highlight .vc {
  color: #008080;
}
.highlight .vg {
  color: #008080;
}
.highlight .vi {
  color: #008080;
}
.highlight .nv, .highlight .vm {
  color: #008080;
}
.highlight .ow {
  color: #000000;
  font-weight: bold;
}
.highlight .o {
  color: #000000;
  font-weight: bold;
}
.highlight .w {
  color: #bbbbbb;
}
.highlight {
  background-color: #f8f8f8;
}
      </style>
        <link href="./css/style.css" rel="stylesheet" type="text/css">

	    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/highlight.min.js"></script>
        <script src="./js/highlightjs-line-numbers.js"></script>
        <script>
          hljs.highlightAll();
          hljs.initLineNumbersOnLoad();
        </script>
    </head>
    <body>
        <div id="menu">
            <ul>
                <li><a href="./index.html">Home</a></li>
                <li><a href="./about.html">About</a></li>
            </ul>
        </div>
        <div id="page">
            <div id="content">
              <h1>
<a aria-hidden="true" class="anchor" href="#setting-up-a-language-server-with-nvim-lspconfig-and-perl-in-neovim-061-in-well-under-5-minutes-if-youre-lucky" id="setting-up-a-language-server-with-nvim-lspconfig-and-perl-in-neovim-061-in-well-under-5-minutes-if-youre-lucky"><span aria-hidden="true" class="octicon octicon-link"></span></a>Setting up a language server with nvim-lspconfig and Perl in Neovim 0.6.1 in well under 5 minutes (if you&#39;re lucky)</h1>
<p><strong>PREFACE</strong>: I knew next to nothing about language servers or using them with neovim until recently. It took many hours of fiddling, experimenting and some <a href="https://www.reddit.com/r/neovim/comments/t37alb/anyone_out_there_have_nvimlspconfig_working_100/">head-banging</a> to get things working. This tutorial is the tutorial I wish existed when I started and should make it dead simple for you. Good luck!</p>
<p><strong>DISCLAIMER</strong>: This tutorial isn&#39;t meant to be exhaustive or the be all and end all authority of setting up language servers with neovim as I&#39;m not an expert on the topic. It&#39;s meant to get you up to speed faster and save you some frustration. When in doubt, <a href="#rtfm">RTFM</a>. If you find any bad mistakes or bad information in this tutorial, email me at <a href="mailto:s@dondley.com">s@dondley.com</a> or <a href="https://github.com/sdondley/ClimateChangeChat/blob/main/setting_up_lsp_nvim-lspconfig_and_perl_in_neovim.md">do a pull request</a> to suggest a change to this page</p>
<p><strong>CAUTION:</strong> I&#39;ve sprinkled this post with expletives and uninformed opinions just to spice things up a little. If you&#39;re humorless or find me unfunny, go <a href="#rtfm">RTFM</a> instead.</p>
<p><strong>UPDATE:</strong> There is now a <a href="fast_as_fuck_perl_language_server_and_completion.html">second tutorial</a> for a third Perl language server, Perl Navigator, with the COQ plugin.</p>


<h1>
<a aria-hidden="true" class="anchor" href="#tldr" id="tldr"><span aria-hidden="true" class="octicon octicon-link"></span></a>TLDR;</h1>
<ul>
<li>This TLDR; section assumes:
<ul>
<li>you know what a language server is and what it might be good for</li>
<li>you know what the nvim-lspconfig plugin is and what it&#39;s for</li>
<li>you can install a perl module from cpan</li>
<li>you can install a neovim plugin</li>
<li>If any of these assumption are wrong or are confusing to you, you should scroll down to the <a href="#wtf">next major section</a>
<ul>
<li>otherwise, proceed to the very next step</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2>
<a aria-hidden="true" class="anchor" href="#basic-setup-get-a-perl-language-server-up-and-running-with-neovim" id="basic-setup-get-a-perl-language-server-up-and-running-with-neovim"><span aria-hidden="true" class="octicon octicon-link"></span></a>Basic setup: Get a Perl language server up and running with neovim</h2>
<ul>
<li>No bells or whistles</li>
<li>Good for just making sure you can get something working before trying more sophisticated configs
<ul>
<li>Good idea to do this first then do advanced set up below</li>
</ul>
</li>
</ul>
<h3>
<a aria-hidden="true" class="anchor" href="#step-1-install-the-language-servers" id="step-1-install-the-language-servers"><span aria-hidden="true" class="octicon octicon-link"></span></a>Step 1: Install the language server(s)</h3>
<ul>
<li>There are 2 langauge servers to choose from, Perl Language Server (PLS) and Perl::LanguageServer
<ul>
<li>From the command line, install one or both:
<ul>
<li>
<code>cpanm PLS</code>
<ul>
<li>I recommend this one</li>
<li>But no code debugging features</li>
</ul>
</li>
<li>
<code>cpanm Perl::LanguageServer</code>
<ul>
<li>I could not get completion working with this one</li>
<li>But does have debugging features
<ul>
<li>I did not confirm if debugging works with neovim</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Step 1 is done</li>
</ul>
<h3>
<a aria-hidden="true" class="anchor" href="#step-2-install-the-nvim-lspconfig-plugin-with-git-and-install-into-neovim" id="step-2-install-the-nvim-lspconfig-plugin-with-git-and-install-into-neovim"><span aria-hidden="true" class="octicon octicon-link"></span></a>Step 2: Install the nvim-lspconfig plugin with git and install into neovim</h3>
<ul>
<li>Use your favorite neovim package manager to install it
<ul>
<li>or the one you hate
<ul>
<li>makes no difference to me</li>
</ul>
</li>
</ul>
</li>
<li>Github repo for nvim-lspconfig is here:
<ul>
<li><code>https://github.com/neovim/nvim-lspconfig</code></li>
</ul>
</li>
<li>Step 2 is done</li>
</ul>
<h3>
<a aria-hidden="true" class="anchor" href="#step-3-throw-one-line-of-lua-code-into-neovims-init-file" id="step-3-throw-one-line-of-lua-code-into-neovims-init-file"><span aria-hidden="true" class="octicon octicon-link"></span></a>Step 3: Throw one line of lua code into neovim&#39;s init file</h3>
<ul>
<li>neovim has complicated vim (even more) by offering two different scripting languages for writing neovim&#39;s configuration files</li>
<li>If you don&#39;t know which language your&#39;re using to configure neovim with, it&#39;s safe to say you&#39;re using vimscript</li>
<li>Decide which langauge server you want to use
<ul>
<li>I recommend PLS</li>
</ul>
</li>
<li>Add the appropriate lua code into your vim configuration
<ul>
<li>for vimscript
<ul>
<li>goes into <code>init.vim</code> file</li>
<li>for PLS: <code>lua require(&#39;lspconfig&#39;).perlpls.setup{}</code>
</li>
<li>for Perl::LangaugeServer: <code>lua require(&#39;lspconfig&#39;).perlls.setup{}</code>
</li>
</ul>
</li>
<li>for lua
<ul>
<li>goes into <code>init.lua</code> file</li>
<li>for lua with PLS: <code>require&#39;lspconfig&#39;.perlpls.setup{}</code>
</li>
<li>for lua with Perl::LanguageServer: <code>require&#39;lspconfig&#39;.perlls.setup{}</code>
</li>
</ul>
</li>
</ul>
</li>
<li>Step 3 is done</li>
</ul>
<h3>
<a aria-hidden="true" class="anchor" href="#step-4" id="step-4"><span aria-hidden="true" class="octicon octicon-link"></span></a>Step 4</h3>
<ul>
<li>There is no step 4. You&#39;re done.</li>
<li>Fire up neovim</li>
<li>Run <code>:LspInfo</code>
</li>
<li>Does it looks like it&#39;s working?
<ul>
<li>Yup, you&#39;re done</li>
</ul>
</li>
<li>&quot;I can&#39;t tell if it&#39;s working.&quot;
<ul>
<li>Then it probably isn&#39;t</li>
<li>But you should see: &quot;Configured servers list: perlpls&quot; (or &quot;perlls&quot;) at the bottom of a popup box</li>
</ul>
</li>
<li>&quot;It&#39;s not working, you idiot!&quot;
<ul>
<li>go back and check for typos</li>
<li>or let me know if you think I fucked up somewhere
<ul>
<li>wouldn&#39;t be the first time</li>
<li>email: <a href="mailto:s@dondley.com">s@dondley.com</a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2>
<a aria-hidden="true" class="anchor" href="#advanced-set-up" id="advanced-set-up"><span aria-hidden="true" class="octicon octicon-link"></span></a>Advanced set up</h2>
<ul>
<li>If you want convenient mappings and cooler stuff like fancier code completion and snippets, follow the steps below</li>
<li>This configuration is ripped almost straight from lspconfig docs
<ul>
<li>You can use a different set of plugins and mappings you can use as you get more skilled</li>
</ul>
</li>
</ul>
<h3>
<a aria-hidden="true" class="anchor" href="#step-1-do-steps-1-and-2-in-the-basic-setup" id="step-1-do-steps-1-and-2-in-the-basic-setup"><span aria-hidden="true" class="octicon octicon-link"></span></a>Step 1: Do steps 1 and 2 in the basic setup</h3>
<ul>
<li>Already did the basic set up?
<ul>
<li><strong>Don&#39;t forget to remove the one-line snippet in step 3 above before proceeding</strong></li>
</ul>
</li>
</ul>
<h3>
<a aria-hidden="true" class="anchor" href="#step-2-install-these-plugins-into-neovim-in-addition-to-the-neovimnvim-lspconfig-plugin" id="step-2-install-these-plugins-into-neovim-in-addition-to-the-neovimnvim-lspconfig-plugin"><span aria-hidden="true" class="octicon octicon-link"></span></a>Step 2: Install these plugins into neovim (in addition to the <code>neovim/nvim-lspconfig</code> plugin):</h3>
<pre><code>hrsh7th/nvim-cmp
hrsh7th/cmp-nvim-lsp
saadparwaiz1/cmp_luasnip
L3MON4D3/LuaSnip
</code></pre>
<h3>
<a aria-hidden="true" class="anchor" href="#step-3-cut-and-paste-a-giant-lua-code-snippet-into-your-neovim-configuration" id="step-3-cut-and-paste-a-giant-lua-code-snippet-into-your-neovim-configuration"><span aria-hidden="true" class="octicon octicon-link"></span></a>Step 3: Cut and paste a giant lua code snippet into your neovim configuration</h3>
<ul>
<li>
<strong>MUY IMPORTANTE</strong>
<ul>
<li>The lua code works for the <code>PLS</code> language server (not the Perl::LangaugeServer)
<ul>
<li>Ensure you have downloaded this langauge server from CPAN before proceeding</li>
</ul>
</li>
<li>And make sure you remove the one-line of lspconfig code from the basic setup above</li>
</ul>
</li>
<li>If you use <code>init.lua</code> for your neovim confguration file, you can drop the code below directly into it</li>
<li>If you use <code>init.vim</code> for your configuration file:
<ul>
<li>Open <code>init.vim</code>
</li>
<li>Add <code>lua require(&#39;lsp_config&#39;)</code> to the file</li>
<li>Now, in the root of you your neovim config directory:
<ul>
<li>create a <code>lua</code> directory if it doesn&#39;t already exist
<ul>
<li>In this directory, create a file called <code>lsp_config.lua</code>
<ul>
<li>drop the code below into it</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<pre><code>local opts = { noremap=true, silent=true }
vim.api.nvim_set_keymap(&#39;n&#39;, &#39;&lt;space&gt;e&#39;, &#39;&lt;cmd&gt;lua vim.diagnostic.open_float()&lt;CR&gt;&#39;, opts)
vim.api.nvim_set_keymap(&#39;n&#39;, &#39;[d&#39;, &#39;&lt;cmd&gt;lua vim.diagnostic.goto_prev()&lt;CR&gt;&#39;, opts)
vim.api.nvim_set_keymap(&#39;n&#39;, &#39;]d&#39;, &#39;&lt;cmd&gt;lua vim.diagnostic.goto_next()&lt;CR&gt;&#39;, opts)
vim.api.nvim_set_keymap(&#39;n&#39;, &#39;&lt;space&gt;q&#39;, &#39;&lt;cmd&gt;lua vim.diagnostic.setloclist()&lt;CR&gt;&#39;, opts)

-- Use an on_attach function to only map the following keys
-- after the language server attaches to the current buffer
local on_attach = function(client, bufnr)
  -- Enable completion triggered by &lt;c-x&gt;&lt;c-o&gt;
  vim.api.nvim_buf_set_option(bufnr, &#39;omnifunc&#39;, &#39;v:lua.vim.lsp.omnifunc&#39;)

  -- Mappings.
  -- See `:help vim.lsp.*` for documentation on any of the below functions
  vim.api.nvim_buf_set_keymap(bufnr, &#39;n&#39;, &#39;gD&#39;, &#39;&lt;cmd&gt;lua vim.lsp.buf.declaration()&lt;CR&gt;&#39;, opts)
  vim.api.nvim_buf_set_keymap(bufnr, &#39;n&#39;, &#39;gd&#39;, &#39;&lt;cmd&gt;lua vim.lsp.buf.definition()&lt;CR&gt;&#39;, opts)
  vim.api.nvim_buf_set_keymap(bufnr, &#39;n&#39;, &#39;K&#39;, &#39;&lt;cmd&gt;lua vim.lsp.buf.hover()&lt;CR&gt;&#39;, opts)
  vim.api.nvim_buf_set_keymap(bufnr, &#39;n&#39;, &#39;gi&#39;, &#39;&lt;cmd&gt;lua vim.lsp.buf.implementation()&lt;CR&gt;&#39;, opts)
  vim.api.nvim_buf_set_keymap(bufnr, &#39;n&#39;, &#39;&lt;C-\&gt;&#39;, &#39;&lt;cmd&gt;lua vim.lsp.buf.signature_help()&lt;CR&gt;&#39;, opts)
  vim.api.nvim_buf_set_keymap(bufnr, &#39;n&#39;, &#39;&lt;space&gt;wa&#39;, &#39;&lt;cmd&gt;lua vim.lsp.buf.add_workspace_folder()&lt;CR&gt;&#39;, opts)
  vim.api.nvim_buf_set_keymap(bufnr, &#39;n&#39;, &#39;&lt;space&gt;wr&#39;, &#39;&lt;cmd&gt;lua vim.lsp.buf.remove_workspace_folder()&lt;CR&gt;&#39;, opts)
  vim.api.nvim_buf_set_keymap(bufnr, &#39;n&#39;, &#39;&lt;space&gt;wl&#39;, &#39;&lt;cmd&gt;lua print(vim.inspect(vim.lsp.buf.list_workspace_folders()))&lt;CR&gt;&#39;, opts)
  vim.api.nvim_buf_set_keymap(bufnr, &#39;n&#39;, &#39;&lt;space&gt;D&#39;, &#39;&lt;cmd&gt;lua vim.lsp.buf.type_definition()&lt;CR&gt;&#39;, opts)
  vim.api.nvim_buf_set_keymap(bufnr, &#39;n&#39;, &#39;&lt;space&gt;rn&#39;, &#39;&lt;cmd&gt;lua vim.lsp.buf.rename()&lt;CR&gt;&#39;, opts)
  vim.api.nvim_buf_set_keymap(bufnr, &#39;n&#39;, &#39;&lt;space&gt;ca&#39;, &#39;&lt;cmd&gt;lua vim.lsp.buf.code_action()&lt;CR&gt;&#39;, opts)
  vim.api.nvim_buf_set_keymap(bufnr, &#39;n&#39;, &#39;gr&#39;, &#39;&lt;cmd&gt;lua vim.lsp.buf.references()&lt;CR&gt;&#39;, opts)
  vim.api.nvim_buf_set_keymap(bufnr, &#39;n&#39;, &#39;&lt;space&gt;f&#39;, &#39;&lt;cmd&gt;lua vim.lsp.buf.formatting()&lt;CR&gt;&#39;, opts)
end

-- Use a loop to conveniently call &#39;setup&#39; on multiple servers and
-- map buffer local keybindings when the language server attaches
local capabilities = vim.lsp.protocol.make_client_capabilities()
capabilities = require(&#39;cmp_nvim_lsp&#39;).update_capabilities(capabilities)
local lspconfig = require(&#39;lspconfig&#39;);
local servers = { &#39;perlpls&#39; }  -- this will load the Perl Language Server (PLS)
--local servers = { &#39;perlls&#39; } -- uncomment this line to use the Perl::LanguageServer language server instead
for _, lsp in pairs(servers) do
  lspconfig[lsp].setup {
    --root_dir = util.find_git_ancestor,
    settings = { 
    perl = { 
        perlcritic = { enabled = true },
        syntax = { enabled = true },
    } 
  },
    single_file_support = true,
    on_attach = on_attach,
    capabilities = capabilities,
    flags = {
        -- This will be the default in neovim 0.7+
        debounce_text_changes = 150,
    }
  }
end

local luasnip = require &#39;luasnip&#39;

-- nvim-cmp setup
local cmp = require &#39;cmp&#39;
cmp.setup {
  snippet = {
    expand = function(args)
      require(&#39;luasnip&#39;).lsp_expand(args.body)
    end,
  },
  mapping = {
    [&#39;&lt;C-p&gt;&#39;] = cmp.mapping.select_prev_item(),
    [&#39;&lt;C-n&gt;&#39;] = cmp.mapping.select_next_item(),
    [&#39;&lt;C-d&gt;&#39;] = cmp.mapping.scroll_docs(-4),
    [&#39;&lt;C-f&gt;&#39;] = cmp.mapping.scroll_docs(4),
    [&#39;&lt;C-Space&gt;&#39;] = cmp.mapping.complete(),
    [&#39;&lt;C-e&gt;&#39;] = cmp.mapping.close(),
    [&#39;&lt;CR&gt;&#39;] = cmp.mapping.confirm {
      behavior = cmp.ConfirmBehavior.Replace,
      select = true,
    },
    [&#39;&lt;Tab&gt;&#39;] = function(fallback)
      if cmp.visible() then
        cmp.select_next_item()
      --elseif luasnip.expand_or_jumpable() then
        --luasnip.expand_or_jump()
      else
        fallback()
      end
    end,
    [&#39;&lt;S-Tab&gt;&#39;] = function(fallback)
      if cmp.visible() then
        cmp.select_prev_item()
      elseif luasnip.jumpable(-1) then
        luasnip.jump(-1)
      else
        fallback()
      end
    end,
  },
  sources = {
    { name = &#39;nvim_lsp&#39; },
    { name = &#39;luasnip&#39; },
  },
}
</code></pre>
</li>
<li>You might not have any clue what this code does
<ul>
<li>This is the TLDR; section so not covered here
<ul>
<li>read the boring details further down in this tutorial</li>
</ul>
</li>
<li>ask questions later
<ul>
<li>just focus on getting it working for now</li>
<li>I&#39;ll hopefully answer at least some of them down lower on the page</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2>
<a aria-hidden="true" class="anchor" href="#thats-it-youre-done" id="thats-it-youre-done"><span aria-hidden="true" class="octicon octicon-link"></span></a>That&#39;s it. You&#39;re done!</h2>
<ul>
<li>Was that so hard?</li>
<li>Check that it&#39;s working:
<ul>
<li>Open neovim</li>
<li>Type <code>:LspInfo</code>
</li>
</ul>
</li>
<li>Does it look like it&#39;s connected?
<ul>
<li>You should see: &quot;Configured servers list: perlpls&quot; at the bottom of a popup box</li>
<li>&quot;Yes, you&#39;re a genius!&quot;
<ul>
<li>Congrats, you know how to copy and paste things into the right place</li>
<li>Feel free to continue with the rest of the tutorial if you&#39;re inclined</li>
</ul>
</li>
<li>&quot;No, you&#39;re an asshole!&quot;
<ul>
<li>OK, then google around and figure it out
<ul>
<li>Or, go bug someone on reddit/stackoverflow/perlmonks with your troubles</li>
<li>Or continue reading to try to gain more insight as to what the problem might be</li>
<li>Or pay me 25 bucks and call me for help
<ul>
<li>Sorry, I don&#39;t do Windows</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2>
<a aria-hidden="true" class="anchor" href="#looking-for-something-more-gratifying-for-your-thirsty-curious-soul" id="looking-for-something-more-gratifying-for-your-thirsty-curious-soul"><span aria-hidden="true" class="octicon octicon-link"></span></a>Looking for something more gratifying for your thirsty, curious soul?</h2>
<p>Continue below...</p>
<h1>
<a aria-hidden="true" class="anchor" href="#wtf" id="wtf"><span aria-hidden="true" class="octicon octicon-link"></span></a>WTF</h1>
<ul>
<li>...is a language server?
<ul>
<li>the &quot;LS&quot; part of an &quot;LSP&quot;, the &quot;Language Server Protocol&quot;
<ul>
<li>see next question</li>
</ul>
</li>
<li>&quot;LSP&quot; and &quot;language server&quot; are often used interchangeably
<ul>
<li>in reality, they are two separate components</li>
</ul>
</li>
</ul>
</li>
<li>...is an <a href="https://microsoft.github.io/language-server-protocol/">LSP</a>?</li>
<li>...is <a href="https://github.com/neovim/nvim-lspconfig">nvim-lspconfig</a>?</li>
<li>...is <a href="https://www.perl.org">Perl</a>?</li>
<li>...is <a href="https://neovim.io">neovim</a>?</li>
</ul>
<p>I&#39;ve googled these for you. You&#39;re welcome.</p>
<h1>
<a aria-hidden="true" class="anchor" href="#the-big-picture-stuff" id="the-big-picture-stuff"><span aria-hidden="true" class="octicon octicon-link"></span></a>The Big Picture Stuff</h1>
<h2>
<a aria-hidden="true" class="anchor" href="#why-a-language-server" id="why-a-language-server"><span aria-hidden="true" class="octicon octicon-link"></span></a>Why a language server?</h2>
<ul>
<li>To write code you use a text editor
<ul>
<li>Text editors require you to type
<ul>
<li>But typing sucks</li>
<li>Programmers have built a bazillion tools to minimize the amount they have to type
<ul>
<li>Wouldn&#39;t you rather use a steam shovel than a spade to dig your home&#39;s foundation?</li>
<li>vim is one of those tools
<ul>
<li>used since the early 80s</li>
</ul>
</li>
<li>More recently, deverlopers have been using &quot;IDEs&quot;
<ul>
<li>not to be confused with &quot;IEDs&quot; or the &quot;IUD&quot;
<ul>
<li>totally different things</li>
</ul>
</li>
<li>&quot;IDE&quot; is an inscutable name
<ul>
<li>stands for &quot;Integrated Development Environment&quot;</li>
<li>makes you sound impressive
<ul>
<li>Weird how programmers love talking about &quot;environments&quot; yet barely go outside</li>
</ul>
</li>
<li>Just a tool for helping you write code faster
<ul>
<li>call it a &quot;coding assistant&quot; to sound less pretentious around real people
<ul>
<li>I&#39;ve never used this term before, I just made it up</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>also help make it easier to look shit up and navigate lots of code</li>
<li>Not without some disadvantages
<ul>
<li>added complexity
<ul>
<li>configuring an IDE to work the way you want can take away a shit ton of time from typing and getting actual coding done</li>
</ul>
</li>
<li>adds a layer of abstraction between you and your code
<ul>
<li>any time not thinking directly about your code and instead thinking about the tool that writes your code is a distraction
<ul>
<li>the real productivity doesn&#39;t kick in until after you get over a confusing learning curve (and a very steep one with vim)</li>
</ul>
</li>
</ul>
</li>
<li>Makes it easier to pump out lots of code
<ul>
<li>but not always good or well-organized code
<ul>
<li>but hey, looks nicely tabbed and spaced like a real pro</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Rough advice, not to be followed strictly
<ul>
<li>Learn to type before learning to code</li>
<li>Learn to code &quot;by hand&quot; before using an IDE</li>
<li>Use an IDE after you learn to program manually</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>So why use a language server?
<ul>
<li>Takes away some of the tedious work of typing and looking shit up</li>
<li>It&#39;s kind of magical and fun to use</li>
<li>Allows you to turn neovim into a somewhat kludgy, poor man&#39;s IDE
<ul>
<li>But an IDE you have absolute full control over (if you know what you are doing)</li>
<li>neovim&#39;s goal seems to be to want to turn vim into a serious IDE
<ul>
<li>that&#39;s my take, anyway</li>
</ul>
</li>
</ul>
</li>
<li>Some common &quot;killer&quot; language server features that programmers really like:
<ul>
<li>Syntax checking
<ul>
<li>tells you in real time if your code has an obvious mistake</li>
<li>but cannot tell you if your code behaves the way you want it to
<ul>
<li>use tests for that
<ul>
<li>IDE can help you manage and run your tests, not a language server</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Auto completion
<ul>
<li>Type in the first character or two of an identifier (a variable, function, class, etc.) and a little menu will pop up to prompt you with some guesses as to what you might want to write
<ul>
<li>You don&#39;t have to type in the full name of the identifier, just choose it from the menu</li>
<li>The more letters you type, the fewer choices that appear are on the menu</li>
<li>Choosing from menu might often be a little slower for shorter names, but:
<ul>
<li>Prevents spelling mistakes, which might end up costing time</li>
<li>muscle memory will eventually kick in and reduce this downside dramatically</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Documentation lookup
<ul>
<li>Forgot what arguments a function takes?</li>
<li>Forgot what a function does?</li>
<li>Need a quick refresher on how classes work?</li>
<li>Forgot how a variable is declared?</li>
<li>A langauge server helps you find the answers you are looking for</li>
</ul>
</li>
<li>Code formatting
<ul>
<li>Avoid spending hours aligning equal signs, indenting just so and eliminating blank lines to make your code look pretty and more readable</li>
<li>perl language servers provide a convenient frontend to perltidy to accomplish this</li>
</ul>
</li>
<li>There&#39;s more a language server can do, but these are the big ones
<ul>
<li>for perl language servers, you&#39;ll have perlcritic standing by to nag you within a tenth of a second about your shit code</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Can&#39;t I already do this with neovim without a language server?
<ul>
<li>Yes, most of it
<ul>
<li>But not quite as conveniently and not quite as fast</li>
<li>Bundles an extra layer of abstraction to provide a bunch of different features so you don&#39;t have to do so much manual configuration and set up of other tools and plugins</li>
</ul>
</li>
</ul>
</li>
<li>Isn&#39;t all the blinking of menus and messages distracting?
<ul>
<li>definitely, at first</li>
<li>eventually, your brain&#39;s autopilot function will learn to tune out the distractions and figure out what to pay attention to</li>
</ul>
</li>
<li>What about using <a href="https://github.com/neoclide/coc.nvim">coc plugins</a> instead?
<ul>
<li>WTF is coc?
<ul>
<li>It&#39;s a suite of plugins that allow you to easily connect to different language servers
<ul>
<li>Created before neovim had a built-in LSP client</li>
</ul>
</li>
</ul>
</li>
<li>I hadn&#39;t used coc up until last week when I experimented with it
<ul>
<li>I&#39;m not qualified to weigh in on the matter, sorry
<ul>
<li>FWIW, from what I&#39;ve read, using neovim&#39;s built-in LSP client is the future of neovim
<ul>
<li>Perhaps coc will just retool and eventually use the built-in client at some point?
<ul>
<li>dunno</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<a href="https://github.com/neovim/nvim-lspconfig/wiki/Comparison-to-other-LSP-ecosystems-(CoC,-vim-lsp,-etc.)">check this document</a> for a more technical comparison of nvim-lspconfig and coc</li>
<li>I think I&#39;ve read that it&#39;s more laggy than using the built-in client</li>
</ul>
</li>
<li>What about <a href="https://github.com/ms-jpq/coq_nvim">coq</a>, the &quot;fast as FUCK&quot; completion plugin?
<ul>
<li>Another neovim plugin but that advertises itself as having very fast fuzzy completion</li>
<li>Apparently works with neovim&#39;s built-in LSP client nvim-lspconfig
<ul>
<li>I tried it only briefly</li>
<li>On my list of things to experiment more with</li>
</ul>
</li>
<li>neovim plugin authors appear to have potty mouths</li>
</ul>
</li>
<li>Why Perl?
<ul>
<li>like English, it&#39;s my native language</li>
<li>I had difficully getting a language server set up with Perl and neovim
<ul>
<li>Not a huge amount of documentation for perl language servers
<ul>
<li>Stuff I did find was wrong or incomplete
<ul>
<li>Some of it has since been updated
<ul>
<li>thanks, in part, to my tireless efforts :)</li>
</ul>
</li>
</ul>
</li>
<li>The two language servers for Perl are not written by people who use neovim
<ul>
<li>they use Perl language servers with &quot;VSCode&quot;</li>
<li>they work mostly by happenstance because it&#39;s an open protocol
<ul>
<li>you can thank MicroSoft for something, at least
<ul>
<li>but fuck Gates and Ballmer
<ul>
<li>always and forever</li>
<li>though kudos to Gates for striving to be a good philanthroper
<ul>
<li>
<strong>almost</strong> erases his sins</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>I wanted others to avoid my initial confusion
<ul>
<li>wrote this</li>
</ul>
</li>
</ul>
</li>
<li>Perl community has the best people
<ul>
<li>IMO, of course</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2>
<a aria-hidden="true" class="anchor" href="#is-setting-up-a-language-server-with-the-neovim-hard" id="is-setting-up-a-language-server-with-the-neovim-hard"><span aria-hidden="true" class="octicon octicon-link"></span></a>Is setting up a language server with the neovim hard?</h2>
<ul>
<li>really depends on the language server
<ul>
<li>for perl, it&#39;s super, super easy</li>
</ul>
</li>
<li>also depends on your skill level
<ul>
<li>if you are new to vim/neovim
<ul>
<li>it&#39;s basically impossible to figure out unless you find a step-by-step recipe identical to your needs
<ul>
<li>but still probably a lot easier than setting up a bunch of different non-LSP plugins to provide similar functionality</li>
</ul>
</li>
</ul>
</li>
<li>If you have at least some experience with neovim
<ul>
<li>It&#39;s not too bad</li>
<li>still a learning curve</li>
<li>it requires some trial and error</li>
</ul>
</li>
</ul>
</li>
<li>Hopefully this web page helps at least a little</li>
<li>As neovim&#39;s lsp matures, will probably get easier</li>
</ul>
<h2>
<a aria-hidden="true" class="anchor" href="#why-does-the-perl-community-seem-to-be-behind-the-curve-on-adopting-languages-servers" id="why-does-the-perl-community-seem-to-be-behind-the-curve-on-adopting-languages-servers"><span aria-hidden="true" class="octicon octicon-link"></span></a>Why does the Perl community seem to be behind the curve on adopting languages servers?</h2>
<ul>
<li>Good question! (if I do say so myself)</li>
<li>Is it really behind the curve?
<ul>
<li>It seems like it to me
<ul>
<li>based on my amateur observations</li>
</ul>
</li>
<li>I could definitely be wrong</li>
</ul>
</li>
<li>I could take many guesses as to why
<ul>
<li>but would just me speculating
<ul>
<li>so no real point to it</li>
</ul>
</li>
</ul>
</li>
<li>Maybe this tutorial will help things along in some small way</li>
</ul>
<h2>
<a aria-hidden="true" class="anchor" href="#my-relevant-background" id="my-relevant-background"><span aria-hidden="true" class="octicon octicon-link"></span></a>My relevant background</h2>
<ul>
<li>totally new to languages servers and nvim-lspconfig
<ul>
<li>until last week</li>
</ul>
</li>
<li>Coding in Perl since late 90s
<ul>
<li>When Perl was king of the web</li>
</ul>
</li>
<li>Mac user since 2008
<ul>
<li>for daily computing</li>
<li>used windows (and PC-DOS) from early 90s until 2008</li>
</ul>
</li>
<li>GNU/Linux user since early 2000s
<ul>
<li>Most familiar with Debian disto</li>
</ul>
</li>
<li>Vim user since early 2000s
<ul>
<li>when I started using Linux</li>
<li>still far from an expert</li>
</ul>
</li>
<li>neovim user for maybe 2 years</li>
<li>Know some vimscript
<ul>
<li>well enough, but very slow to code it</li>
<li>no idea how to go about architecting a sophisticated plugin with it</li>
</ul>
</li>
<li>Never used a languages server until last week
<ul>
<li>I know just about zilch about how they work
<ul>
<li>beyond knowing they follow a traditional &quot;client/server&quot; paradigm</li>
</ul>
</li>
</ul>
</li>
<li>Never used a proper IDE except for dabbling a little with XCode</li>
<li>Never wrote a line of lua until last week</li>
</ul>
<h2>
<a aria-hidden="true" class="anchor" href="#assumptions-about-your-background" id="assumptions-about-your-background"><span aria-hidden="true" class="octicon octicon-link"></span></a>Assumptions about your background</h2>
<ul>
<li>Have been using vim for at least a few months</li>
<li>Know at least the basics of how to configure neovim</li>
<li>You know your way around perl and installing perl modules</li>
</ul>
<h2>
<a aria-hidden="true" class="anchor" href="#will-this-work-for-windows" id="will-this-work-for-windows"><span aria-hidden="true" class="octicon octicon-link"></span></a>Will this work for Windows?</h2>
<ul>
<li>No idea. Good luck. You&#39;re on your own.</li>
<li>Fuck Windows
<ul>
<li>sure, it&#39;s better than it used to be but old perceptions die hard</li>
<li>no OS without a decent command line built into it is worth anything</li>
<li>I have only so much time to figure this shit out
<ul>
<li>no time to learn whatever you have to hack to get something working in Windows
<ul>
<li>I&#39;ll leave it to more qualified people than me</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>My advice?
<ul>
<li>if you&#39;re gonna do open source, use <code>*nix</code>
<ul>
<li>macs are fine</li>
<li>using a virtual linux box is better
<ul>
<li>but I&#39;m not looking for another box to administer</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1>
<a aria-hidden="true" class="anchor" href="#the-more-technical-stuff" id="the-more-technical-stuff"><span aria-hidden="true" class="octicon octicon-link"></span></a>The more technical stuff</h1>
<h2>
<a aria-hidden="true" class="anchor" href="#smaller-picture-stuff" id="smaller-picture-stuff"><span aria-hidden="true" class="octicon octicon-link"></span></a>Smaller picture stuff</h2>
<ul>
<li>as mentioned above, my knowledge of language servers is basically zero
<ul>
<li>but from what I&#39;ve learned so far...
<ul>
<li>There is a client (vim)</li>
<li>There is a server (the language server)</li>
<li>There is the protocol
<ul>
<li>used by the server and client to talk to each other</li>
</ul>
</li>
<li>a client can attach itself to multiple servers</li>
<li>a server can service multiple clients but the clients have be use different ports (AFAICT)</li>
</ul>
</li>
</ul>
</li>
<li>you need to install the language server on your box
<ul>
<li>we will cover how to do this later
<ul>
<li>spoiler: one <code>cpanm</code> command does the trick</li>
</ul>
</li>
<li>language server can be used by neovim or another other piece of software that knows how</li>
<li>there&#39;s generally two or three for each programming language
<ul>
<li>there are more for more popular languages</li>
<li>why is there often more than server for each language?
<ul>
<li>I have no idea
<ul>
<li>geeks are sometimes territorial?</li>
</ul>
</li>
</ul>
</li>
<li>How do I know which one to use
<ul>
<li>It depends on what you need it to do
<ul>
<li>Not all language servers have the same feature set
<ul>
<li>read the langauge server&#39;s documentation
<ul>
<li>should spell things out</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>The ones that seem to work are the better ones</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>you need to configure neovim to use the language server you installed
<ul>
<li>we will cover the settings needed to connect to the perl language servers in a bit</li>
<li>this is where the nvim-lspconfig plugin comes in
<ul>
<li>written in a language called &quot;lua&quot;
<ul>
<li>why lua?
<ul>
<li>I have no idea other than neovim uses it
<ul>
<li>why does neovim use it?
<ul>
<li>I have no idea</li>
<li>as an ignorant jackass that doesn&#39;t want to learn something new, I can only come to one obvious conclusion:
<ul>
<li>some hipster developer thought it provided a new, edgy look</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>the upshot is you have to write a bit of lua code to configure neovim
<ul>
<li>don&#39;t worry, just cut and paste
<ul>
<li>seems like a pretty easy language to pick up, though</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>neovim has a built-in client for &quot;talking&quot; to a language server
<ul>
<li>in essence, neovim is the client for the server</li>
</ul>
</li>
<li>but have to tell the client (neovim) which language server you want to use
<ul>
<li>so you use nvim-lspconfig, a plugin, to tell neovim about the language server</li>
</ul>
</li>
<li>you can also set other basic settings with nvim-lspconfig to change:
<ul>
<li>how neovim responds to the language server</li>
<li>how you want the language server to respond to neovim</li>
</ul>
</li>
<li>you can still use other plugins to connect to a language server and even bypass neovim&#39;s built-in client
<ul>
<li>those plugins will be slower than the built-in language client neovim provides</li>
<li>and it&#39;s wasteful to duplicate the same effort in each plugin</li>
</ul>
</li>
<li>nvim-lspconfig aims to simplify the process of connecting neovim to a language server</li>
</ul>
</li>
</ul>
</li>
<li>In addition to nvim-lspconfig you will probably want to use other plugins
<ul>
<li>to try to achieve a &quot;true IDE&quot; experience
<ul>
<li>plugins for code completion, for example</li>
</ul>
</li>
<li>you don&#39;t have to use other plugins
<ul>
<li>for example, you can use omnifunc with nvim-lspconfig for completion
<ul>
<li>but not as nice</li>
<li>btw, using <code>&lt;c-x&gt;&lt;c-whatever&gt;</code> is probably its worst design decision in vim
<ul>
<li>there might good reasons for it but I don&#39;t know what they are
<ul>
<li>so I&#39;ll just stick with &quot;it sucks&quot;</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>for snippets
<ul>
<li>again, totally optional to install a snippets plugin</li>
<li>helps you automatically write code from templates</li>
<li>I know litte about snippets, never used them much
<ul>
<li>too lazy to learn how to use them</li>
</ul>
</li>
<li>the kids seem to go fucking nuts about them</li>
<li>I kind of like to type shit out
<ul>
<li>kind of relaxing</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2>
<a aria-hidden="true" class="anchor" href="#the-stuff-in-between-probably-what-you-really-want-to-know" id="the-stuff-in-between-probably-what-you-really-want-to-know"><span aria-hidden="true" class="octicon octicon-link"></span></a>The stuff in between (probably what you really want to know)</h2>
<h3>
<a aria-hidden="true" class="anchor" href="#there-are-two-perl-language-servers-that-work-with-neovim-that-i-know-of" id="there-are-two-perl-language-servers-that-work-with-neovim-that-i-know-of"><span aria-hidden="true" class="octicon octicon-link"></span></a>There are two Perl language servers that work with neovim (that I know of)</h3>
<ul>
<li>First of all, thanks to the software authors of these language servers
<ul>
<li>I greatly appreciate your work!</li>
<li>Be sure to pass along your gratitude and maybe even a tip</li>
</ul>
</li>
<li>The two (known) Perl language servers are:
<ul>
<li>Perl::LanguageServer (P::LS)
<ul>
<li>Author: Gerald Richter</li>
<li>GitHub Link: <a href="https://github.com/richterger/Perl-LanguageServer">https://github.com/richterger/Perl-LanguageServer</a>
</li>
<li>CPAN Link: <a href="https://metacpan.org/pod/Perl::LanguageServer">https://metacpan.org/pod/Perl::LanguageServer</a>
</li>
</ul>
</li>
<li>Perl-Language-Server (PLS)
<ul>
<li>Author: &quot;FractalBoy&quot;</li>
<li>GitHub Link: <a href="https://github.com/FractalBoy/perl-language-server">https://github.com/FractalBoy/perl-language-server</a>
</li>
<li>CPAN Link: <a href="https://metacpan.org/pod/PLS">https://metacpan.org/pod/PLS</a>
</li>
</ul>
</li>
</ul>
</li>
<li>What&#39;s the difference?
<ul>
<li>from a technical perspective, I have no idea</li>
<li>PLS is newer
<ul>
<li>but has smaller feature set
<ul>
<li>can&#39;t tap into debug interface provided by perl
<ul>
<li>I just use <code>print &#39;hi&#39;;</code> as my goto debugging tool, anyway
<ul>
<li>or <code>print &#39;fuck you&#39;;</code> when I&#39;m feeling frustrated</li>
</ul>
</li>
<li>not a deal breaker for me</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>P:LS is older
<ul>
<li>but seems to have some kinks
<ul>
<li>I could not get completion feature working
<ul>
<li>If you got it working, let me know how:
<ul>
<li><a href="mailto:s@dondley.com">s@dondley.com</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>they seem more similar than different
<ul>
<li>both are perl modules</li>
<li>both are easily installed from cpan repo</li>
<li>both are free to use</li>
<li>they have nearly the same name</li>
<li>both developers apparently code with vscode, not neovim</li>
<li>but both can work with neovim (maybe, see below)</li>
<li>both have kind of weak documentation for setting up with neovim
<ul>
<li>at least they when I started writing this</li>
<li>hence this tutorial</li>
</ul>
</li>
</ul>
</li>
<li>Is one faster than the other?
<ul>
<li>no idea</li>
<li>after my very limited use, both seem about the same to me</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4>
<a aria-hidden="true" class="anchor" href="#a-third-perl-langauge-server" id="a-third-perl-langauge-server"><span aria-hidden="true" class="octicon octicon-link"></span></a>A third Perl langauge server?</h4>
<ul>
<li>There is another Perl language server project</li>
<li>Came to my attention after writing this blog post</li>
<li>Called <a href="https://github.com/bscan/PerlNavigator">&quot;PerlNavigator&quot;</a>
</li>
<li>Does not yet work with neovim</li>
<li>Developer &quot;bscan&quot; <a href="https://www.reddit.com/r/perl/comments/t4inwe/comment/hz0dg4j/?utm_source=share&amp;utm_medium=web2x&amp;context=3">is looking for help</a> getting it working with neovim</li>
<li>See <a href="fast_as_fuck_perl_language_server_and_completion.html">my second perl langauge server tutorial to use it</a>
</li>
</ul>
<h2>
<a aria-hidden="true" class="anchor" href="#ok-the-stuff-you-really-need-to-know-to-get-some-real-work-done" id="ok-the-stuff-you-really-need-to-know-to-get-some-real-work-done"><span aria-hidden="true" class="octicon octicon-link"></span></a>OK, the stuff you really need to know to get some real work done</h2>
<ul>
<li>with all that out of the way, we can finally get some shit done</li>
<li>First, we download both language servers so you can try them both out
<ul>
<li>I use <code>cpanm</code> as my tool of choice for installing perl modules
<ul>
<li>see TLDR; above for the commands</li>
</ul>
</li>
</ul>
</li>
<li>having perlbrew installed is fine
<ul>
<li>I didn&#39;t run into any issues</li>
<li>running 5.34.0 version of perl</li>
</ul>
</li>
<li>Now we configure neovim</li>
<li>first complication we run into is which package manager to use to install the nvim-lspconfig plugin
<ul>
<li>there are a butt ton of them</li>
<li>managing plugins is probably one of the most confusing parts of vim (amongst many)</li>
<li>this tutorial is not designed to be a vim package manager tutorial
<ul>
<li>it&#39;s long enough as it is</li>
<li>google it</li>
</ul>
</li>
<li>If you use the packer package manager, here&#39;s the relevant parts of my packer config:
<pre><code>return require(&#39;packer&#39;).startup( {
    function()
        use { &#39;neovim/nvim-lspconfig&#39;, opt = true, ft = &#39;perl&#39; }  -- LSP config plugin
        use { &#39;hrsh7th/nvim-cmp&#39; } -- Autocompletion plugin
        use &#39;hrsh7th/cmp-nvim-lsp&#39; -- LSP source for nvim-cmp
        use &#39;saadparwaiz1/cmp_luasnip&#39; -- Snippets source for nvim-cmp
        use &#39;L3MON4D3/LuaSnip&#39; -- Snippets plugin
    end,
})
</code></pre>
</li>
<li>Note the 4 other plugins listed here, in addition to <code>nvim-lspconfig</code>
<ul>
<li>These plugins are not strictly needed
<ul>
<li>add bells and whistles like better auto completion and snippets</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Got nvim-lspconfig installed? Good! Now:
<ul>
<li>Go back to the top of the this page
<ul>
<li>Follow the rest of the instructions in the <a href="#tldr;">TLDR;</a> section
<ul>
<li>Ensure you get all the plugins installed (for when you do the advanced setup)</li>
<li>Paste in the appropriate code snippets into <code>init.lua</code> or <code>init.vim</code>
</li>
</ul>
</li>
<li>Then come back here if you want to suffer more through this tutorial to learn something</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2>
<a aria-hidden="true" class="anchor" href="#some-gory-details-for-those-with-a-relentless-quest-for-knowledge" id="some-gory-details-for-those-with-a-relentless-quest-for-knowledge"><span aria-hidden="true" class="octicon octicon-link"></span></a>Some gory details for those with a relentless quest for knowledge</h2>
<ul>
<li>This section goes into some detail on what the code snippet you pasted above does</li>
<li>One caveat: I&#39;m not an expert in Lua or configuing the language server
<ul>
<li>so take the technical discussion in this section with a bit of grain of salt</li>
</ul>
</li>
</ul>
<h3>
<a aria-hidden="true" class="anchor" href="#analzying-the-giant-lua-code-snippet" id="analzying-the-giant-lua-code-snippet"><span aria-hidden="true" class="octicon octicon-link"></span></a>Analzying the giant lua code snippet</h3>
<ul>
<li>as mentioned, all you really need is this one single line to connect to the perl language server:
<ul>
<li>
<code>require&#39;lspconfig.perlpls&#39;.setup{}</code> (for the PLS server)</li>
</ul>
</li>
<li>The bulk of the lua code is mostly dedicated to adding mappings for lspconfig</li>
</ul>
<h4>
<a aria-hidden="true" class="anchor" href="#setting-up-mappings" id="setting-up-mappings"><span aria-hidden="true" class="octicon octicon-link"></span></a>Setting up mappings</h4>
<ul>
<li>Mappings make it easier to interact with the language server</li>
<li>This code sets up some gobal key maps, common to all buffers and all langauge servers
<pre><code>local opts = { noremap=true, silent=true }
vim.api.nvim_set_keymap(&#39;n&#39;, &#39;&lt;space&gt;e&#39;, &#39;&lt;cmd&gt;lua vim.diagnostic.open_float()&lt;CR&gt;&#39;, opts)
vim.api.nvim_set_keymap(&#39;n&#39;, &#39;[d&#39;, &#39;&lt;cmd&gt;lua vim.diagnostic.goto_prev()&lt;CR&gt;&#39;, opts)
vim.api.nvim_set_keymap(&#39;n&#39;, &#39;]d&#39;, &#39;&lt;cmd&gt;lua vim.diagnostic.goto_next()&lt;CR&gt;&#39;, opts)
vim.api.nvim_set_keymap(&#39;n&#39;, &#39;&lt;space&gt;q&#39;, &#39;&lt;cmd&gt;lua vim.diagnostic.setloclist()&lt;CR&gt;&#39;, opts)
</code></pre>
</li>
<li>Next, we set up more keymaps that are specific to buffers, each of which might be connetected to a different language server
<ul>
<li>You might have one buffer open for programming in perl</li>
<li>Another buffer for programming c</li>
<li>each buffer will connect to the approprate language server</li>
</ul>
<pre><code>-- Use an on_attach function to only map the following keys
-- after the language server attaches to the current buffer
local on_attach = function(client, bufnr)
      -- Enable completion triggered by &lt;c-x&gt;&lt;c-o&gt;
      vim.api.nvim_buf_set_option(bufnr, &#39;omnifunc&#39;, &#39;v:lua.vim.lsp.omnifunc&#39;)

      -- Mappings.
      -- See `:help vim.lsp.*` for documentation on any of the below functions
      vim.api.nvim_buf_set_keymap(bufnr, &#39;n&#39;, &#39;gD&#39;, &#39;&lt;cmd&gt;lua vim.lsp.buf.declaration()&lt;CR&gt;&#39;, opts)
      vim.api.nvim_buf_set_keymap(bufnr, &#39;n&#39;, &#39;gd&#39;, &#39;&lt;cmd&gt;lua vim.lsp.buf.definition()&lt;CR&gt;&#39;, opts)
      vim.api.nvim_buf_set_keymap(bufnr, &#39;n&#39;, &#39;K&#39;, &#39;&lt;cmd&gt;lua vim.lsp.buf.hover()&lt;CR&gt;&#39;, opts)
      vim.api.nvim_buf_set_keymap(bufnr, &#39;n&#39;, &#39;gi&#39;, &#39;&lt;cmd&gt;lua vim.lsp.buf.implementation()&lt;CR&gt;&#39;, opts)
      vim.api.nvim_buf_set_keymap(bufnr, &#39;n&#39;, &#39;&lt;C-\&gt;&#39;, &#39;&lt;cmd&gt;lua vim.lsp.buf.signature_help()&lt;CR&gt;&#39;, opts)
      vim.api.nvim_buf_set_keymap(bufnr, &#39;n&#39;, &#39;&lt;space&gt;wa&#39;, &#39;&lt;cmd&gt;lua vim.lsp.buf.add_workspace_folder()&lt;CR&gt;&#39;, opts)
      vim.api.nvim_buf_set_keymap(bufnr, &#39;n&#39;, &#39;&lt;space&gt;wr&#39;, &#39;&lt;cmd&gt;lua vim.lsp.buf.remove_workspace_folder()&lt;CR&gt;&#39;, opts)
      vim.api.nvim_buf_set_keymap(bufnr, &#39;n&#39;, &#39;&lt;space&gt;wl&#39;, &#39;&lt;cmd&gt;lua print(vim.inspect(vim.lsp.buf.list_workspace_folders()))&lt;CR&gt;&#39;, opts)
      vim.api.nvim_buf_set_keymap(bufnr, &#39;n&#39;, &#39;&lt;space&gt;D&#39;, &#39;&lt;cmd&gt;lua vim.lsp.buf.type_definition()&lt;CR&gt;&#39;, opts)
      vim.api.nvim_buf_set_keymap(bufnr, &#39;n&#39;, &#39;&lt;space&gt;rn&#39;, &#39;&lt;cmd&gt;lua vim.lsp.buf.rename()&lt;CR&gt;&#39;, opts)
      vim.api.nvim_buf_set_keymap(bufnr, &#39;n&#39;, &#39;&lt;space&gt;ca&#39;, &#39;&lt;cmd&gt;lua vim.lsp.buf.code_action()&lt;CR&gt;&#39;, opts)
      vim.api.nvim_buf_set_keymap(bufnr, &#39;n&#39;, &#39;gr&#39;, &#39;&lt;cmd&gt;lua vim.lsp.buf.references()&lt;CR&gt;&#39;, opts)
      vim.api.nvim_buf_set_keymap(bufnr, &#39;n&#39;, &#39;&lt;space&gt;f&#39;, &#39;&lt;cmd&gt;lua vim.lsp.buf.formatting()&lt;CR&gt;&#39;, opts)
end
</code></pre>
</li>
<li>Note these mappings get wrapped in a function called <code>attach</code>. They are added only when you connect to a language server</li>
<li>What do these key mappings do?
<ul>
<li>This isn&#39;t an IDE tutorial
<ul>
<li>Not going to cover them here</li>
</ul>
</li>
<li>Plus, I don&#39;t know what all of them do
<ul>
<li>the code above was cargo culted from lspconfig documentation</li>
</ul>
</li>
<li>If you&#39;ve used an IDE before, you probably know more than me</li>
<li>Some maps are pretty obvious from the description</li>
<li>Play with them and find out</li>
</ul>
</li>
</ul>
<h4>
<a aria-hidden="true" class="anchor" href="#connecting-vim-to-our-language-servers" id="connecting-vim-to-our-language-servers"><span aria-hidden="true" class="octicon octicon-link"></span></a>Connecting vim to our language servers</h4>
<ul>
<li>Now we get to the meat of the matter</li>
<li>First we set up the capabilities of the server
<pre><code>local capabilities = vim.lsp.protocol.make_client_capabilities()
capabilities = require(&#39;cmp_nvim_lsp&#39;).update_capabilities(capabilities)
</code></pre>
<ul>
<li>I really don&#39;t know what exactly this does, TBH</li>
<li>Looks like we are telling neovim to use our plugin for completion</li>
</ul>
</li>
<li>Next we connect to the lspconfig
<ul>
<li>We assign our lspconfig plugin to a variable
<pre><code>local lspconfig = require(&#39;lspconfig&#39;);
</code></pre>
</li>
</ul>
</li>
<li>Now we add the list of language servers we want to use to the <code>servers</code> variable:
<pre><code>local servers = { &#39;perlpls&#39; }  -- this will connect to the Perl Language Server (PLS)
--local servers = { &#39;perlls&#39; } -- uncomment this line to use the Perl::LanguageServer language server instead
</code></pre>
</li>
<li>Note that we can add more than one language server here. Just add the name of it to the comma separated list
<ul>
<li>consult the language server documenation for the name</li>
<li>each buffer should just use one language server
<ul>
<li>though it&#39;s possible to connect to multiple ones at the same time</li>
</ul>
</li>
</ul>
</li>
<li>Now we are ready to connect to the server(s) by looping over the <code>servers</code> list:
<pre><code>-- Use a loop to conveniently call &#39;setup&#39; on multiple servers and
-- map buffer local keybindings when the language server attaches
for _, lsp in pairs(servers) do
  lspconfig[lsp].setup {
    --root_dir = util.find_git_ancestor,
    settings = { 
    perl = { 
        perlcritic = { enabled = true },
        syntax = { enabled = true },
    } 
  },
    single_file_support = true,
    on_attach = on_attach,
    capabilities = capabilities,
    flags = {
        -- This will be the default in neovim 0.7+
        debounce_text_changes = 150,
    }
  }
end
</code></pre>
</li>
<li>A breakdown of these settings
<ul>
<li>Not sure what <code>--root_dir</code> setting does
<ul>
<li>RTFM</li>
<li>Confession: I don&#39;t always RTFM</li>
<li>Cargo culted it</li>
<li>Don&#39;t even think it&#39;s needed</li>
</ul>
</li>
<li>
<code>settings</code>:
<ul>
<li>This is the most important part of the lua code</li>
<li>Consult language server documentation for what goes here</li>
<li>Settings above work with PLS, not P::LS
<ul>
<li>enables perlcritic
<ul>
<li>nags you with warnings about how your code style sucks</li>
</ul>
</li>
<li>enables syntax checking
<ul>
<li>compiles your code on the fly and throws a warning if there&#39;s a problem
<ul>
<li>huge time saver</li>
<li>my biggest motiviation for using an LSP
<ul>
<li>I make a shit ton of dumb mistakes</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>consult each language server&#39;s documentation for setting confugrations
<ul>
<li>should have a special section for nvim-lspconfig</li>
<li>nvim-lspconfig also has a <a href="https://github.com/neovim/nvim-lspconfig/blob/master/doc/server_configurations.md">compendium of settings</a> for different language servers
<ul>
<li>be careful, they might be dated</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<code>--single_file_support</code>
<ul>
<li>I only have a vague idea what this does</li>
<li>won&#39;t speculate
<ul>
<li>Don&#39;t be like me, <a href="#rtfm">RTFM</a>
</li>
</ul>
</li>
</ul>
</li>
<li>
<code>on_attach</code>
<ul>
<li>attaches our buffer maps</li>
</ul>
</li>
<li>
<code>capabilities</code>
<ul>
<li>tells <code>lspconfig</code> what plugin to use for certain features
<ul>
<li>I think</li>
<li>here we tell it to use the completion capability we set earlier using <code>nvim-cmp</code>
</li>
</ul>
</li>
</ul>
</li>
<li>
<code>flags</code>
<ul>
<li>passes config settings to the language client</li>
<li>consult neovim&#39;s <a href="https://neovim.io/doc/user/lsp.html">lsp documentation</a>
</li>
</ul>
</li>
<li>
<code>debounce_text_changes</code>
<ul>
<li>don&#39;t touch this unless you know what you are doing
<ul>
<li>I don&#39;t</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4>
<a aria-hidden="true" class="anchor" href="#set-up-completion-completion-mappings-and-snippets" id="set-up-completion-completion-mappings-and-snippets"><span aria-hidden="true" class="octicon octicon-link"></span></a>Set up completion, completion mappings, and snippets</h4>
<ul>
<li>I know very little about completions or snippets</li>
<li>Not going to weigh in on this code
<ul>
<li>Except to say it seems to work (at least the completion)
<ul>
<li>and it sets up maps</li>
</ul>
</li>
<li>I haven&#39;t experimented with snippets yet</li>
</ul>
<pre><code>local luasnip = require &#39;luasnip&#39;

-- nvim-cmp setup
local cmp = require &#39;cmp&#39;
cmp.setup {
  snippet = {
    expand = function(args)
      require(&#39;luasnip&#39;).lsp_expand(args.body)
    end,
  },
  mapping = {
    [&#39;&lt;C-p&gt;&#39;] = cmp.mapping.select_prev_item(),
    [&#39;&lt;C-n&gt;&#39;] = cmp.mapping.select_next_item(),
    [&#39;&lt;C-d&gt;&#39;] = cmp.mapping.scroll_docs(-4),
    [&#39;&lt;C-f&gt;&#39;] = cmp.mapping.scroll_docs(4),
    [&#39;&lt;C-Space&gt;&#39;] = cmp.mapping.complete(),
    [&#39;&lt;C-e&gt;&#39;] = cmp.mapping.close(),
    [&#39;&lt;CR&gt;&#39;] = cmp.mapping.confirm {
      behavior = cmp.ConfirmBehavior.Replace,
      select = true,
    },
    [&#39;&lt;Tab&gt;&#39;] = function(fallback)
      if cmp.visible() then
        cmp.select_next_item()
      --elseif luasnip.expand_or_jumpable() then
        --luasnip.expand_or_jump()
      else
        fallback()
      end
    end,
    [&#39;&lt;S-Tab&gt;&#39;] = function(fallback)
      if cmp.visible() then
        cmp.select_prev_item()
      elseif luasnip.jumpable(-1) then
        luasnip.jump(-1)
      else
        fallback()
      end
    end,
  },
  sources = {
    { name = &#39;nvim_lsp&#39; },
    { name = &#39;luasnip&#39; },
  },
}
</code></pre>
</li>
</ul>
<h1>
<a aria-hidden="true" class="anchor" href="#rtfm" id="rtfm"><span aria-hidden="true" class="octicon octicon-link"></span></a>RTFM</h1>
<ul>
<li>eating vegetables sucks too but they&#39;re good for you</li>
<li>get answers for things I didn&#39;t bother to RTFM for</li>
</ul>
<h2>
<a aria-hidden="true" class="anchor" href="#neovim-docs" id="neovim-docs"><span aria-hidden="true" class="octicon octicon-link"></span></a>neovim docs</h2>
<ul>
<li><code>:h lsp</code></li>
<li><code>:h lspconfig</code></li>
</ul>
<h2>
<a aria-hidden="true" class="anchor" href="#github-docs" id="github-docs"><span aria-hidden="true" class="octicon octicon-link"></span></a>Github docs</h2>
<ul>
<li><a href="https://github.com/neovim/nvim-lspconfig/wiki">lspconfig wiki</a></li>
<li>
<a href="">Perl::LangaugeServer</a><a href="https://github.com/richterger/Perl-LanguageServer">https://github.com/richterger/Perl-LanguageServer</a>
</li>
<li>
<a href="">PLS</a><a href="https://github.com/FractalBoy/perl-language-server">https://github.com/FractalBoy/perl-language-server</a>
</li>
</ul>
<h2>
<a aria-hidden="true" class="anchor" href="#perl-language-server-cpan-docs" id="perl-language-server-cpan-docs"><span aria-hidden="true" class="octicon octicon-link"></span></a>Perl language server cpan docs</h2>
<ul>
<li><a href="https://metacpan.org/pod/Perl::LanguageServer">Perl::LanguageServer</a></li>
<li><a href="https://metacpan.org/pod/PLS">Perl-Language-Server (PLS)</a></li>
</ul>

            </div>
            <div id="toc">
                <div>
                <h6>
<a aria-hidden="true" class="anchor" href="#on-this-page" id="on-this-page"><span aria-hidden="true" class="octicon octicon-link"></span></a>On This Page</h6><ul>
<li><a href="#setting-up-a-language-server-with-nvim-lspconfig-and-perl-in-neovim-061-in-well-under-5-minutes-if-youre-lucky">Setting up a language server with nvim-lspconfig and Perl in Neovim 0.6.1 in well under 5 minutes (if you&#39;re lucky)</a></li>
<li>
<a href="#tldr">TLDR;</a>
<ul>
<li>
<a href="#basic-setup-get-a-perl-language-server-up-and-running-with-neovim">Basic setup: Get a Perl language server up and running with neovim</a>
<ul>
<li><a href="#step-1-install-the-language-servers">Step 1: Install the language server(s)</a></li>
<li><a href="#step-2-install-the-nvim-lspconfig-plugin-with-git-and-install-into-neovim">Step 2: Install the nvim-lspconfig plugin with git and install into neovim</a></li>
<li><a href="#step-3-throw-one-line-of-lua-code-into-neovims-init-file">Step 3: Throw one line of lua code into neovim&#39;s init file</a></li>
<li><a href="#step-4">Step 4</a></li>
</ul>
</li>
<li>
<a href="#advanced-set-up">Advanced set up</a>
<ul>
<li><a href="#step-1-do-steps-1-and-2-in-the-basic-setup">Step 1: Do steps 1 and 2 in the basic setup</a></li>
<li><a href="#step-2-install-these-plugins-into-neovim-in-addition-to-the-neovimnvim-lspconfig-plugin">Step 2: Install these plugins into neovim (in addition to the <code>neovim/nvim-lspconfig</code> plugin):</a></li>
<li><a href="#step-3-cut-and-paste-a-giant-lua-code-snippet-into-your-neovim-configuration">Step 3: Cut and paste a giant lua code snippet into your neovim configuration</a></li>
</ul>
</li>
<li><a href="#thats-it-youre-done">That&#39;s it. You&#39;re done!</a></li>
<li><a href="#looking-for-something-more-gratifying-for-your-thirsty-curious-soul">Looking for something more gratifying for your thirsty, curious soul?</a></li>
</ul>
</li>
<li><a href="#wtf">WTF</a></li>
<li>
<a href="#the-big-picture-stuff">The Big Picture Stuff</a>
<ul>
<li><a href="#why-a-language-server">Why a language server?</a></li>
<li><a href="#is-setting-up-a-language-server-with-the-neovim-hard">Is setting up a language server with the neovim hard?</a></li>
<li><a href="#why-does-the-perl-community-seem-to-be-behind-the-curve-on-adopting-languages-servers">Why does the Perl community seem to be behind the curve on adopting languages servers?</a></li>
<li><a href="#my-relevant-background">My relevant background</a></li>
<li><a href="#assumptions-about-your-background">Assumptions about your background</a></li>
<li><a href="#will-this-work-for-windows">Will this work for Windows?</a></li>
</ul>
</li>
<li>
<a href="#the-more-technical-stuff">The more technical stuff</a>
<ul>
<li><a href="#smaller-picture-stuff">Smaller picture stuff</a></li>
<li>
<a href="#the-stuff-in-between-probably-what-you-really-want-to-know">The stuff in between (probably what you really want to know)</a>
<ul>
<li>
<a href="#there-are-two-perl-language-servers-that-work-with-neovim-that-i-know-of">There are two Perl language servers that work with neovim (that I know of)</a>
<ul>
<li><a href="#a-third-perl-langauge-server">A third Perl langauge server?</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#ok-the-stuff-you-really-need-to-know-to-get-some-real-work-done">OK, the stuff you really need to know to get some real work done</a></li>
<li>
<a href="#some-gory-details-for-those-with-a-relentless-quest-for-knowledge">Some gory details for those with a relentless quest for knowledge</a>
<ul>
<li>
<a href="#analzying-the-giant-lua-code-snippet">Analzying the giant lua code snippet</a>
<ul>
<li><a href="#setting-up-mappings">Setting up mappings</a></li>
<li><a href="#connecting-vim-to-our-language-servers">Connecting vim to our language servers</a></li>
<li><a href="#set-up-completion-completion-mappings-and-snippets">Set up completion, completion mappings, and snippets</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#rtfm">RTFM</a>
<ul>
<li><a href="#neovim-docs">neovim docs</a></li>
<li><a href="#github-docs">Github docs</a></li>
<li><a href="#perl-language-server-cpan-docs">Perl language server cpan docs</a></li>
</ul>
</li>
</ul></div><div id="update_date"><span id="update_label">Last updated: </span> March 4, 2022 10:31 AM</div><div id="publish_date"><span id="publish_label">First published: </span>March 1, 2022</div>
            </div>
        </div>
        <script src="./js/zenscroll/zenscroll-min.js"></script>
        <script>
          zenscroll.setup(200, 50);
          </script>
    </body>

